WITH preps AS (SELECT Segment_id, id_offset, content FROM udhr_ocr_c789824360354006aa3cf723bed8d2db_1.prepared_Segment WHERE Segment_id = ANY(:sids)),
    meta AS (SELECT
    "Segment"."segment_id" AS "Segment_id", "Segment"."char_range" AS "Segment_char_range", "Segment"."xy_box" AS "Segment_xy_box", "Document"."document_id" AS "Document_id", "Document"."char_range" AS "Document_char_range", "Document"."xy_box" AS "Document_xy_box", "Document"."page" AS "Document_page"
FROM
    preps
    LEFT JOIN "udhr_ocr_c789824360354006aa3cf723bed8d2db_1"."segmentrest" "Segment" ON "Segment"."segment_id" = preps."segment_id"
    LEFT JOIN "udhr_ocr_c789824360354006aa3cf723bed8d2db_1"."document" "Document" ON "Document"."char_range" @> "Segment"."char_range"
GROUP BY
    "Segment"."segment_id", "Document"."document_id", "Document"."page")
SELECT -1::int2 AS rstype, jsonb_build_array(preps.segment_id, preps.id_offset, preps.content) FROM preps
UNION ALL
SELECT -2::int2 AS rstype, jsonb_build_array(meta."Segment_id", meta."Segment_char_range", meta."Segment_xy_box", meta."Document_id", meta."Document_char_range", meta."Document_xy_box", meta."Document_page") FROM meta;
